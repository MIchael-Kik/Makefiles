# Project Compiler, shared lib
CXX = g++
CXXFLAGS = -Wall -I./include
LDFLAGS =
INSTALLDIR =/usr/local/lib
APPNAME = "APPNAME"

ifndef config
	config=debug
endif

ifeq ($(config),debug)
	CXXFLAGS += -g
else ifeq ($(config),optimize)
	CXXFLAGS += -O3
else ifeq ($(config),release)
	CXXFLAGS += -O3
	CXXFLAGS += -s
endif

BIN = ../lib$(APPNAME).so
OBJDIR = ../obj/$(APPNAME)
SRCDIR = src

SRC = $(wildcard $(SRCDIR)/*.cpp)
OBJ = $(SRC:$(SRCDIR)/%.cpp=$(OBJDIR)/%.o)
DEP = $(OBJ:$(OBJDIR)/%.o=%.d)

all: $(BIN)

#FINAL LINK STEP
$(BIN): $(OBJ)
	$(CXX) $(CXXFLAGS) -fPIC -shared -o $@ $^ $(LDFLAGS)	

%.d: $(SRCDIR)/%.cpp
	@$(CPP) $(CFLAGS) $< -MM -MT $(@:%.d=$(OBJDIR)/%.o) >$@

-include $(DEP)

$(OBJDIR)/%.o: $(SRCDIR)/%.cpp
	$(CXX) $(CXXFLAGS) -o $@ -c $<

uninstall:
	rm -f $(INSTALLDIR)/$(APPNAME)

install: all
	cp -f $(BIN) $(INSTALLDIR)/lib$(APPNAME).so
	chmod 755 $(INSTALLDIR)/lib$(APPNAME).so

clean:
	rm -f $(OBJ) $(DEP) $(BIN)	
